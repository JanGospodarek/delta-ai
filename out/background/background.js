(function(){"use strict";const p={apiKey:null},T=e=>{p.apiKey=e},w=()=>p.apiKey,C=(e,i,s)=>{switch(console.log("messageController",e,i,s),e.action){case"set-api-key":T(e.apiKey),s({message:"success"});break;case"get-api-key":{const o=w();s(o?{status:"success",data:{apiKey:o}}:{status:"error",message:"API Key not set"});break}case"test":console.log("TEST MESSAGE RECIEVED"),s({status:"Service worker is working properly!"});break;default:console.log("messageController: unknown action",e.action)}},E=()=>document.documentElement.outerHTML,k=e=>{const s=new DOMParser().parseFromString(e,"text/html"),o={};function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)})}function u(t){const r=t.getBoundingClientRect();return{top:r.top+window.scrollY,left:r.left+window.scrollX}}return s.querySelectorAll(".formulation").forEach(t=>{var d,f;const r=l(),a=u(t),m=t.querySelectorAll('input[type="radio"] + label');if(m.length>0){const n=((d=t.querySelector(".qtext"))==null?void 0:d.textContent.trim())||"",c=Array.from(m).map(h=>h.textContent.trim());o[r]={question:n,answers:c,position:a};return}const y=t.querySelector("table");if(y){const n=((f=t.querySelector(".qtext"))==null?void 0:f.textContent.trim())||"",c=[];y.querySelectorAll("tr").forEach(q=>{var A;const S=((A=q.querySelector("td:first-child"))==null?void 0:A.textContent.trim())||"",b=Array.from(q.querySelectorAll("select option")).filter(x=>x.value).map(x=>x.textContent.trim());S&&b.length>0&&c.push({subQuestion:S,availableAnswers:b})}),c.length>0&&(o[r]={question:n,subQuestions:c,position:a});return}const g=Array.from(t.childNodes).map(n=>n.nodeType===Node.TEXT_NODE?n.textContent.trim():n.nodeType===Node.ELEMENT_NODE&&n.tagName==="SPAN"?"[Answer here]":"").filter(n=>n).join(" ");g&&(o[r]={question:g,answers:[],position:a})}),o},K=(e,i,s)=>{const{url:o}=i;o.includes("delta.pk.edu.pl/mod/quiz/attempt")&&o.includes("attempt=")&&(console.log(`Tab ${e} URL changed to: ${i.url}`),chrome.scripting.executeScript({target:{tabId:e},func:E},l=>{const u=l[0].result,t=k(u);console.log("questions:",t)}))};chrome.runtime.onMessage.addListener(C),chrome.tabs.onUpdated.addListener(K)})();
